#include "ns3/core-module.h"
#include "ns3/network-module.h"
#include "ns3/internet-module.h"
#include "ns3/point-to-point-module.h"
#include "ns3/applications-module.h"
#include "ns3/csma-module.h"
#include "ns3/point-to-point-layout-module.h"


//                  TOPOLOGY
//
//                    n4
//                  / | \ 
//  n0  n1  n2----n3--n5--n7    n8  n9  
//  |   |   |       \ | /  |    |   |
//  =========         n6   ==========
//
//
//




using namespace ns3;


NS_LOG_COMPONENT_DEFINE ("task1");

int
main (int argc, char *argv[])
{
    CommandLine cmd(__FILE__);
    cmd.Parse(argc, argv);

    Time::SetResolution (Time::NS);

    LogComponentEnable("UdpEchoClientApplication", LOG_LEVEL_INFO);
    LogComponentEnable("UdpEchoServerApplication", LOG_LEVEL_INFO);

    NS_LOG_INFO ("Install internet stack on all nodes.");
    InternetStackHelper internet;

    // nodes 0, 1, 2 - CSMA LEFT
    NS_LOG_INFO ("CSMA Left");
    NodeContainer CSMA1_nodes;
    CSMA1_nodes.Create(3);

    CsmaHelper CSMA1;
    CSMA1.SetChannelAttribute ("DataRate", StringValue ("25Mbps"));
    CSMA1.SetChannelAttribute ("Delay", StringValue ("10us"));
    
    NetDeviceContainer CSMA1_ND = CSMA1.Install(CSMA1_nodes);

    internet.Install(CSMA1_nodes);

    Ipv4AddressHelper address;
    address.SetBase ("192.128.1.0", "255.255.255.0");
    Ipv4InterfaceContainer CSMA1_interfaces;
    CSMA1_interfaces = address.Assign (CSMA1_ND);



    // star node5
    NS_LOG_INFO ("Build star topology.");
    uint32_t nSpokes = 4;

    PointToPointHelper starN5;
    starN5.SetDeviceAttribute ("DataRate", StringValue ("80Mbps"));
    starN5.SetChannelAttribute ("Delay", StringValue ("5s"));

    PointToPointStarHelper star (nSpokes, starN5);

    star.InstallStack (internet);

    NS_LOG_INFO ("Assign IP Addresses.");
    star.AssignIpv4Addresses (Ipv4AddressHelper ("10.10.1.0", "255.255.255.0"));
    

    // nodes 2 and 3
    NS_LOG_INFO ("Point to Point n2 - n3");
    NodeContainer n2n3_nodes;
    n2n3_nodes.Add(CSMA1_nodes.Get(2));
    n2n3_nodes.Add(star.GetSpokeNode(0));

    // PointToPointHelper n2n3;
    // n2n3.SetDeviceAttribute ("DataRate", StringValue ("100Mbps"));
    // n2n3.SetChannelAttribute ("Delay", StringValue ("15us"));

    // NetDeviceContainer n2n3_ND = n2n3.Install(n2n3_nodes);



    internet.Install(n2n3_nodes.Get(1));

    address.SetBase ("10.1.1.0", "255.255.255.252");
    Ipv4InterfaceContainer n2n3_interfaces;
    n2n3_interfaces = address.Assign (n2n3_ND);





    //pointToPoint.EnablePcap("task1-.......", n2n3_ND.Get(1))
    //csma.EnablePcap("task1-........", CSMA1_ND.get(0))

    
	Simulator::Run();
    Simulator::Destroy();

    return 0;
}



